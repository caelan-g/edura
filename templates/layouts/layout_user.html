<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    {% if session['page'] == 'dashboard' and session['user_type'] == 'student'
    %}
    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-3.6.2.min.js"></script>
    <link
      href="https://cdn.bokeh.org/bokeh/release/bokeh-3.6.2.min.css"
      rel="stylesheet"
    />
    {% endif %}
    <title>Study App</title>
    <!--<link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static', filename='tailwind.min.css')}}"
    />-->
  </head>
  <body class="flex flex-row bg-gray-50">
    <nav
      class="bg-gray-800 text-white font-bold p-2 flex flex-col align-middle h-full fixed w-48 pt-24 pb-20 gap-10"
    >
      <div class="text-2xl px-2 flex flex-row">Study App</div>
      <div class="flex flex-col gap-2">
        {% if session['user_type'] == 'student' %}
        <div class="transition-all w-full my-8">
          {% if not session['start_study_time'] %}
          <div
            class="peer font-bold rounded-full bg-blue-500 px-2 py-1 flex justify-between w-28 cursor-pointer"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="2"
              stroke="currentColor"
              class="size-5 relative top-[0.1em]"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M15.91 11.672a.375.375 0 0 1 0 .656l-5.603 3.113a.375.375 0 0 1-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112Z"
              />
            </svg>

            Timer
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="2"
              stroke="currentColor"
              class="size-5 relative left-[-0.1em] top-[0.1em]"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="m19.5 8.25-7.5 7.5-7.5-7.5"
              />
            </svg>
          </div>
          {% else %}
          <a
            onclick="stopTimer(), nav_popup('session_popup')"
            class="font-bold rounded-full bg-blue-500 px-2 py-1 flex justify-between w-28 cursor-pointer relative"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="2"
              stroke="currentColor"
              class="size-5 relative top-[0.1em]"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9 9.563C9 9.252 9.252 9 9.563 9h4.874c.311 0 .563.252.563.563v4.874c0 .311-.252.563-.563.563H9.564A.562.562 0 0 1 9 14.437V9.564Z"
              />
            </svg>
            <div id="timer" class="flex flex-row">
              <div id="hour">{{session['timer_hr']}}</div>
              <div>:</div>
              <div id="minute">{{session['timer_min']}}</div>
              <div>:</div>
              <div id="second">{{session['timer_sec']}}</div>
            </div>
          </a>
          {% endif %}
          <div
            class="w-full z-50 opacity-0 pointer-events-none peer-hover:opacity-100 hover:pointer-events-auto hover:opacity-100 peer-hover:pointer-events-auto flex flex-col gap-2 transition-all border rounded-md p-2 bg-white absolute"
          >
            {% for class in classes %}
            <a
              href="{{ url_for('add_study', class_id=class[0]) }}"
              onclick="startTimer()"
              class="p-2 font-bold text-xs text-green-500 rounded-md bg-green-200 text-ellipsis text-ellipsis overflow-hidden text-nowrap"
              >{{class[1]}}</a
            >
            {% endfor %}
          </div>
        </div>
        {% endif %}
        <a
          href="/dashboard"
          class="flex gap-2 {% if session['page'] == 'dashboard' %} bg-gray-700 {% endif %} hover:bg-gray-700 transition-all px-2 py-2 rounded-md"
          ><svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="2"
            stroke="currentColor"
            class="size-5 relative top-[0.1em]"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 17.25v1.007a3 3 0 0 1-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0 1 15 18.257V17.25m6-12V15a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 15V5.25m18 0A2.25 2.25 0 0 0 18.75 3H5.25A2.25 2.25 0 0 0 3 5.25m18 0V12a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 12V5.25"
            />
          </svg>
          Dashboard</a
        >
        {% if session['user_type'] == 'student' %}
        <a
          href="/sessions"
          class="flex gap-2 {% if session['page'] == 'sessions' %} bg-gray-700 {% endif %} hover:bg-gray-700 transition-all px-2 py-2 rounded-md"
          ><svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="2"
            stroke="currentColor"
            class="size-5 relative top-[0.1em]"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M4.26 10.147a60.438 60.438 0 0 0-.491 6.347A48.62 48.62 0 0 1 12 20.904a48.62 48.62 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.636 50.636 0 0 0-2.658-.813A59.906 59.906 0 0 1 12 3.493a59.903 59.903 0 0 1 10.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.717 50.717 0 0 1 12 13.489a50.702 50.702 0 0 1 7.74-3.342M6.75 15a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm0 0v-3.675A55.378 55.378 0 0 1 12 8.443m-7.007 11.55A5.981 5.981 0 0 0 6.75 15.75v-1.5"
            />
          </svg>
          Sessions</a
        >
        {% endif %}
        <a
          href="/settings"
          class="flex gap-2 {% if session['page'] == 'settings' %} bg-gray-700 {% endif %} hover:bg-gray-700 transition-all px-2 py-2 rounded-md"
          ><svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="2"
            stroke="currentColor"
            class="size-5 relative top-[0.1em]"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 0 1 1.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.107 1.204.165.397.505.71.93.78l.893.15c.543.09.94.559.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.894.149c-.424.07-.764.383-.929.78-.165.398-.143.854.107 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 0 1-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.398.165-.71.505-.781.929l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.148-.894c-.071-.424-.384-.764-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 0 1-.12-1.45l.527-.737c.25-.35.272-.806.108-1.204-.165-.397-.506-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.109v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.108-1.204l-.526-.738a1.125 1.125 0 0 1 .12-1.45l.773-.773a1.125 1.125 0 0 1 1.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894Z"
            />
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
            />
          </svg>
          Settings</a
        >

        <a class="flex gap-2 opacity-50 px-2 py-2"
          ><svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="2"
            stroke="currentColor"
            class="size-5 relative top-[0.1em]"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
            />
          </svg>
          {{session['username']}}</a
        >
        <a
          href="/logout"
          class="flex gap-2 px-2 py-2 hover:bg-gray-700 transition-all rounded-md"
          ><svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="2"
            stroke="currentColor"
            class="size-5 relative top-[0.1em]"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M8.25 9V5.25A2.25 2.25 0 0 1 10.5 3h6a2.25 2.25 0 0 1 2.25 2.25v13.5A2.25 2.25 0 0 1 16.5 21h-6a2.25 2.25 0 0 1-2.25-2.25V15m-3 0-3-3m0 0 3-3m-3 3H15"
            />
          </svg>
          Log out</a
        >
      </div>
    </nav>
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %}
    <div
      id="message"
      class="translate-y-[-5rem] transition-all duration-300 mx-auto flex justify-center w-full font-bold text-gray-800 text-center fixed top-4 z-50 px-auto"
    >
      {% for category, message in messages %} {% if category == 'success' %}
      <div
        class="bg-green-100 p-2 rounded-md border border-green-200 text-nowrap"
      >
        {{message}}
      </div>
      {% else %}
      <div class="bg-red-100 p-2 rounded-md border border-red-200 text-nowrap">
        {{message}}
      </div>
      {% endif %} {% endfor %}
    </div>
    {% endif %} {% endwith %}
    <div class="lg:ml-52 lg:mr-24 lg:my-12 ml-48 w-full">
      {% block body %} {% endblock %}
    </div>
    <div
      id="session_popup"
      class="opacity-0 fixed transition-all fixed inset-0 bg-opacity-50 bg-black w-full h-full pointer-events-none flex justify-center scale-110"
    >
      <div
        class="bg-white w-[30rem] rounded-md p-12 mx-auto my-auto align-middle"
        onclick="event.stopPropagation()"
      >
        <form action="/add_study" method="post">
          <div class="text-2xl font-bold">Log Study Session</div>
          <input
            class="bg-gray-100 p-2 rounded-md w-full my-6"
            autocomplete="off"
            name="description"
            placeholder="Description"
            type="text"
          />
          <div class="flex flex-row gap-2">
            <button
              type="submit"
              class="bg-gray-800 p-2 font-bold text-white rounded-md w-full text-center"
            >
              Complete Study Session
            </button>
          </div>
        </form>
      </div>
    </div>
    <script>
      window.onload = function () {
        messagePopup = document.getElementById("message");
        messagePopup.classList.remove("translate-y-[-5rem]");
        setTimeout(() => {
          messagePopup.classList.add("translate-y-[-5rem]");
        }, 2000);
      };
    </script>
    <script defer>
      let timer = false;
      let second = parseInt(document.getElementById("second").innerHTML);
      let minute = parseInt(document.getElementById("minute").innerHTML);
      let hour = parseInt(document.getElementById("hour").innerHTML);
      let secondString;
      let minuteString;
      let hourString;
      startTimer();

      function startTimer() {
        timer = true;
        stopwatch();
      }

      function stopTimer() {
        timer = false;
      }

      function stopwatch() {
        if (timer) {
          second++;
          if (second == 60) {
            second = 0;
            minute += 1;
          }
          if (minute == 60) {
            minute = 0;
            hour += 1;
          }

          if (second < 10) {
            secondString = "0" + second.toString();
          } else {
            secondString = second.toString();
          }
          if (minute < 10) {
            minuteString = "0" + minute.toString();
          } else {
            minuteString = minute.toString();
          }
          if (hour < 10) {
            hourString = "0" + hour.toString();
          } else {
            hourString = hour.toString();
          }
          document.getElementById("second").innerHTML = secondString;
          document.getElementById("minute").innerHTML = minuteString;
          document.getElementById("hour").innerHTML = hourString;
          fetch("/update_session_timer", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              timer_sec: secondString,
              timer_min: minuteString,
              timer_hr: hourString,
            }),
          });
          setTimeout(stopwatch, 1000);
        }
      }

      function nav_popup(popup_id) {
        let popup = document.getElementById(popup_id);
        if (popup.classList.contains("opacity-0")) {
          popup.classList.add("opacity-100", "scale-100");
          popup.classList.remove(
            "opacity-0",
            "pointer-events-none",
            "scale-110"
          );
        } else {
          popup.classList.add("opacity-0", "pointer-events-none", "scale-110");
          popup.classList.remove("opacity-100", "scale-100");
        }
      }
    </script>
  </body>
</html>
